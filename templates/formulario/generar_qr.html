{% extends 'base.html' %}
{% load static %}

{% block title %}Generar QR{% endblock %}

{% block content %}
<div class="container">
    <div class="header">
        <img src="{% static 'img/Logo_ACT.png' %}" alt="ACT Logo" class="logo">
        <h1>AUTORIZACIÓN</h1>
    </div>

    <div id="input-section" class="card">
        <h3>Ingrese los Datos del Propietario</h3>
        <form method="post" id="qr-form">
            {% csrf_token %}
            
            {% if form.errors %}
            <div class="error-message">
                <strong>Error:</strong> Por favor, corrija los siguientes errores.
                <ul>
                    {% for field, errors in form.errors.items %}
                        {% for error in errors %}
                            <li>{{ field }}: {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <div class="form-group">
                <label for="id_placa">Placa</label>
                {{ form.placa }}
            </div>
            
            <div class="form-group">
                <label for="id_nombres">Nombres</label>
                {{ form.nombres }}
            </div>
            
            <div class="form-group">
                <label for="id_tipo_identificacion">Tipo de identificación</label>
                {{ form.tipo_identificacion }}
            </div>
            
            <div class="form-group" id="input-id-container">
                <!-- Se llena dinámicamente con JavaScript -->
            </div>

            <div class="form-group">
                <label for="id_correo">Correo Electrónico</label>
                {{ form.correo }}
            </div>
            
            <div class="form-group">
                <label for="id_telefono">Teléfono</label>
                {{ form.telefono }}
            </div>
            
            <div class="form-group">
                <label for="id_tipo_autorizacion">Tipo de Autorización</label>
                {{ form.tipo_autorizacion }}
            </div>
            
            <div class="form-group" id="input-autorizacion-container">
                <!-- Se llena dinámicamente con JavaScript -->
            </div>
            
            <div class="form-group">
                <label for="id_numero_autorizacion">Número de Autorización</label>
                {{ form.numero_autorizacion }}
            </div>
            
            <div class="form-group">
                <label for="id_vigencia">Vigencia</label>
                {{ form.vigencia }}
            </div>
            
            <button type="submit" class="submit-btn">Validar y Generar QR</button>
        </form>
        <div id="result-message" class="error"></div>
    </div>

    {% if qr_generado %}
    <div id="qr-container" class="card">
        <h3>Código QR Generado</h3>
        <div id="qrcode"></div>
        <div class="action-buttons">
            <button class="download-btn" onclick="downloadQR()">Descargar QR (PNG)</button>
            <button class="pdf-btn" onclick="generatePDF()">Generar PDF de Autorización</button>
        </div>
    </div>

    <div id="auth-details" class="card">
        <h3>Detalles de la Autorización</h3>
        <p><strong>Número de Documento:</strong> <span id="auth-autorizacion">{{ autorizacion_data.numero_autorizacion }}</span></p>
        <p><strong>Placa:</strong> <span id="auth-placa">{{ autorizacion_data.placa }}</span></p>
        <p><strong>Nombres:</strong> <span id="auth-nombre">{{ autorizacion_data.nombres }}</span></p>
        <p><strong>Tipo de Autorización:</strong> <span id="auth-tipo-autorizacion">{{ autorizacion_data.tipo_autorizacion }}</span></p>
        <p><strong>Vigencia:</strong> <span id="auth-caducidad">{{ autorizacion_data.vigencia }}</span></p>
        
        {% if autorizacion_data.esta_caducada %}
        <div class="expiration-message">
            <h4>⚠️ AUTORIZACIÓN CADUCADA</h4>
            <p>Esta autorización ya no es válida. Por favor, renueve su permiso.</p>
        </div>
        {% endif %}
    </div>
    {% endif %}
</div>

<script>
// Variables globales - INICIALIZAR CORRECTAMENTE
let currentPlaca = '{{ autorizacion_data.placa|default:"" }}';
let currentQrUrl = '{{ qr_url|default:"" }}';
let currentData = {
    placa: '{{ autorizacion_data.placa|default:"" }}',
    nombres: '{{ autorizacion_data.nombres|default:"" }}',
    numero_autorizacion: '{{ autorizacion_data.numero_autorizacion|default:"" }}',
    tipo_autorizacion: '{{ autorizacion_data.tipo_autorizacion|default:"" }}',
    vigencia: '{{ autorizacion_data.vigencia|default:"" }}'
};

// Inicialización cuando el DOM está listo
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM cargado');
    console.log('QR Generado:', {{ qr_generado|default:False|lower }});
    console.log('QR URL:', currentQrUrl);
    console.log('Placa:', currentPlaca);
    
    // Establecer fecha mínima como hoy
    const today = new Date().toISOString().split('T')[0];
    const vigenciaInput = document.getElementById('id_vigencia');
    if (vigenciaInput) {
        vigenciaInput.min = today;
    }
    
    // Inicializar campos de identificación
    mostrarInputID();
    
    // Inicializar campos de autorización
    mostrarInputAutorizacion();
    
    // Generar QR si ya hay datos
    {% if qr_generado and qr_url %}
    console.log('Intentando generar QR...');
    setTimeout(function() {
        const success = generateQR();
        console.log('QR generado:', success);
    }, 100);
    {% endif %}
    
    // Agregar validación en tiempo real para campos numéricos
    agregarValidacionTiempoReal();
});

// Mostrar campos de identificación según el tipo seleccionado
function mostrarInputID() {
    const tipoSelect = document.getElementById('id_tipo_identificacion');
    const container = document.getElementById('input-id-container');
    
    if (!tipoSelect || !container) return;
    
    const tipo = tipoSelect.value;
    container.innerHTML = '';
    
    if (tipo === 'cedula') {
        container.innerHTML = `
            <label for="id_cedula">Cédula (10 dígitos - Empieza con 09) *</label>
            <input type="text" id="id_cedula" name="cedula" class="form-control" 
                   placeholder="Ej: 0956305672" 
                   pattern="^09\\d{8}$" 
                   title="La cédula debe comenzar con 09 y tener 10 dígitos"
                   maxlength="10"
                   required>
            <small class="form-hint">Formato: 09XXXXXXXX (10 dígitos en total)</small>
        `;
    } else if (tipo === 'ruc') {
        container.innerHTML = `
            <label for="id_ruc">RUC (13 dígitos) *</label>
            <input type="text" id="id_ruc" name="ruc" class="form-control" 
                   placeholder="Ej: 1234567890123" 
                   pattern="^\\d{13}$" 
                   title="El RUC debe tener 13 dígitos"
                   maxlength="13"
                   required>
            <small class="form-hint">Formato: 13 dígitos numéricos</small>
        `;
    } else if (tipo === 'ambos') {
        container.innerHTML = `
            <div class="form-row-double">
                <div class="form-group-inline">
                    <label for="id_cedula">Cédula (10 dígitos - Empieza con 09) *</label>
                    <input type="text" id="id_cedula" name="cedula" class="form-control" 
                           placeholder="Ej: 0956305672" 
                           pattern="^09\\d{8}$" 
                           title="La cédula debe comenzar con 09 y tener 10 dígitos"
                           maxlength="10"
                           required>
                    <small class="form-hint">Formato: 09XXXXXXXX</small>
                </div>
                <div class="form-group-inline">
                    <label for="id_ruc">RUC (13 dígitos) *</label>
                    <input type="text" id="id_ruc" name="ruc" class="form-control" 
                           placeholder="Ej: 1234567890123" 
                           pattern="^\\d{13}$" 
                           title="El RUC debe tener 13 dígitos"
                           maxlength="13"
                           required>
                    <small class="form-hint">Formato: 13 dígitos</small>
                </div>
            </div>
        `;
    }
    
    // Agregar validación en tiempo real a los nuevos campos
    agregarValidacionTiempoReal();
}

// Mostrar campos de autorización personalizada si es necesario
function mostrarInputAutorizacion() {
    const tipoSelect = document.getElementById('id_tipo_autorizacion');
    const container = document.getElementById('input-autorizacion-container');
    
    if (!tipoSelect || !container) return;
    
    const selectedOption = tipoSelect.options[tipoSelect.selectedIndex];
    const tipoTexto = selectedOption ? selectedOption.text.toLowerCase() : '';
    
    if (tipoTexto.includes('otro') || tipoTexto.includes('otra')) {
        container.innerHTML = `
            <label for="id_tipo_autorizacion_otro">Especifique el tipo de autorización</label>
            <input type="text" id="id_tipo_autorizacion_otro" name="tipo_autorizacion_otro" 
                   class="form-control" placeholder="Ingrese el tipo de autorización">
        `;
    } else {
        container.innerHTML = '';
    }
}

// Agregar validación en tiempo real
function agregarValidacionTiempoReal() {
    // Validar cédula
    const cedulaInput = document.getElementById('id_cedula');
    if (cedulaInput) {
        cedulaInput.addEventListener('input', function(e) {
            let valor = this.value.replace(/[^0-9]/g, '');
            if (valor.length > 10) {
                valor = valor.slice(0, 10);
            }
            this.value = valor;
            
            if (valor.length === 10 && valor.startsWith('09')) {
                this.classList.remove('invalid');
                this.classList.add('valid');
            } else if (valor.length > 0) {
                this.classList.remove('valid');
                this.classList.add('invalid');
            } else {
                this.classList.remove('valid', 'invalid');
            }
        });
        
        cedulaInput.addEventListener('blur', function() {
            if (this.value.length > 0 && this.value.length !== 10) {
                alert('La cédula debe tener exactamente 10 dígitos');
            } else if (this.value.length === 10 && !this.value.startsWith('09')) {
                alert('La cédula debe comenzar con 09');
            }
        });
    }
    
    // Validar RUC
    const rucInput = document.getElementById('id_ruc');
    if (rucInput) {
        rucInput.addEventListener('input', function(e) {
            let valor = this.value.replace(/[^0-9]/g, '');
            if (valor.length > 13) {
                valor = valor.slice(0, 13);
            }
            this.value = valor;
            
            if (valor.length === 13) {
                this.classList.remove('invalid');
                this.classList.add('valid');
            } else if (valor.length > 0) {
                this.classList.remove('valid');
                this.classList.add('invalid');
            } else {
                this.classList.remove('valid', 'invalid');
            }
        });
        
        rucInput.addEventListener('blur', function() {
            if (this.value.length > 0 && this.value.length !== 13) {
                alert('El RUC debe tener exactamente 13 dígitos');
            }
        });
    }
    
    // Validar teléfono
    const telefonoInput = document.getElementById('id_telefono');
    if (telefonoInput) {
        telefonoInput.addEventListener('input', function(e) {
            let valor = this.value.replace(/[^0-9]/g, '');
            if (valor.length > 10) {
                valor = valor.slice(0, 10);
            }
            this.value = valor;
            
            if (valor.length === 10 && valor.startsWith('09')) {
                this.classList.remove('invalid');
                this.classList.add('valid');
            } else if (valor.length > 0) {
                this.classList.remove('valid');
                this.classList.add('invalid');
            } else {
                this.classList.remove('valid', 'invalid');
            }
        });
        
        telefonoInput.addEventListener('blur', function() {
            if (this.value.length > 0 && this.value.length !== 10) {
                alert('El teléfono debe tener exactamente 10 dígitos');
            } else if (this.value.length === 10 && !this.value.startsWith('09')) {
                alert('El teléfono debe comenzar con 09');
            }
        });
    }
}

// Validaciones del formulario antes de enviar
document.getElementById('qr-form').addEventListener('submit', function(e) {
    const tipoIdentificacion = document.getElementById('id_tipo_identificacion').value;
    const message = document.getElementById('result-message');
    
    message.textContent = '';
    message.className = '';
    
    let isValid = true;
    let errorMessage = '';

    if (!tipoIdentificacion) {
        isValid = false;
        errorMessage = 'Debe seleccionar un tipo de identificación.';
    } else {
        if (tipoIdentificacion === 'cedula') {
            const cedula = document.getElementById('id_cedula');
            if (!cedula || !cedula.value.trim()) {
                isValid = false;
                errorMessage = 'La cédula es requerida para este tipo de identificación.';
            } else {
                const cedulaVal = cedula.value.trim();
                if (cedulaVal.length !== 10) {
                    isValid = false;
                    errorMessage = 'La cédula debe tener exactamente 10 dígitos.';
                } else if (!cedulaVal.startsWith('09')) {
                    isValid = false;
                    errorMessage = 'La cédula debe comenzar con 09. Ejemplo: 0956305672';
                } else if (!/^\d+$/.test(cedulaVal)) {
                    isValid = false;
                    errorMessage = 'La cédula debe contener solo números.';
                }
            }
        } else if (tipoIdentificacion === 'ruc') {
            const ruc = document.getElementById('id_ruc');
            if (!ruc || !ruc.value.trim()) {
                isValid = false;
                errorMessage = 'El RUC es requerido cuando selecciona "RUC" como tipo de identificación.';
            } else {
                const rucVal = ruc.value.trim();
                if (rucVal.length !== 13) {
                    isValid = false;
                    errorMessage = 'El RUC debe tener exactamente 13 dígitos.';
                } else if (!/^\d+$/.test(rucVal)) {
                    isValid = false;
                    errorMessage = 'El RUC debe contener solo números.';
                }
            }
        } else if (tipoIdentificacion === 'ambos') {
            const cedula = document.getElementById('id_cedula');
            const ruc = document.getElementById('id_ruc');
            
            if (!cedula || !cedula.value.trim() || !ruc || !ruc.value.trim()) {
                isValid = false;
                errorMessage = 'Ambos campos de identificación son requeridos.';
            } else {
                const cedulaVal = cedula.value.trim();
                const rucVal = ruc.value.trim();
                
                if (cedulaVal.length !== 10) {
                    isValid = false;
                    errorMessage = 'La cédula debe tener exactamente 10 dígitos.';
                } else if (!cedulaVal.startsWith('09')) {
                    isValid = false;
                    errorMessage = 'La cédula debe comenzar con 09.';
                } else if (!/^\d+$/.test(cedulaVal)) {
                    isValid = false;
                    errorMessage = 'La cédula debe contener solo números.';
                } else if (rucVal.length !== 13) {
                    isValid = false;
                    errorMessage = 'El RUC debe tener exactamente 13 dígitos.';
                } else if (!/^\d+$/.test(rucVal)) {
                    isValid = false;
                    errorMessage = 'El RUC debe contener solo números.';
                }
            }
        }
    }
    
    if (isValid) {
        const telefono = document.getElementById('id_telefono');
        if (telefono && telefono.value.trim()) {
            const telefonoVal = telefono.value.trim();
            if (telefonoVal.length !== 10) {
                isValid = false;
                errorMessage = 'El teléfono debe tener exactamente 10 dígitos.';
            } else if (!telefonoVal.startsWith('09')) {
                isValid = false;
                errorMessage = 'El teléfono debe comenzar con 09. Ejemplo: 0987654321';
            } else if (!/^\d+$/.test(telefonoVal)) {
                isValid = false;
                errorMessage = 'El teléfono debe contener solo números.';
            }
        }
    }
    
    if (!isValid) {
        e.preventDefault();
        message.textContent = errorMessage;
        message.className = 'error';
        return;
    }
    
    message.textContent = 'Procesando formulario...';
    message.className = 'success';
});

// Generar código QR - CORREGIDO
function generateQR() {
    const qrContainer = document.getElementById('qrcode');
    if (!qrContainer) {
        console.error('No se encontró el contenedor del QR');
        return false;
    }
    
    qrContainer.innerHTML = '';
    
    const qrUrl = currentQrUrl || '{{ qr_url|default:"" }}';
    console.log('Generando QR con URL:', qrUrl);
    
    if (!qrUrl) {
        console.error('No hay URL para el QR');
        return false;
    }
    
    try {
        new QRCode(qrContainer, {
            text: qrUrl,
            width: 256,
            height: 256,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H
        });
        console.log('QR generado exitosamente');
        return true;
    } catch (error) {
        console.error('Error generando QR:', error);
        return false;
    }
}

// Descargar QR como PNG - CORREGIDO
function downloadQR() {
    console.log('Intentando descargar QR...');
    console.log('Placa actual:', currentPlaca);
    
    if (!currentPlaca) {
        alert('Error: No hay una placa válida. Por favor, genere primero un QR.');
        return;
    }
    
    const qrCanvas = document.querySelector('#qrcode canvas');
    console.log('Canvas encontrado:', qrCanvas);
    
    if (!qrCanvas) {
        alert('No se encontró el QR para descargar. Por favor, genere primero el código QR.');
        return;
    }
    
    try {
        const link = document.createElement('a');
        link.download = `QR_Placa_${currentPlaca}.png`;
        link.href = qrCanvas.toDataURL('image/png');
        link.click();
        console.log('Descarga iniciada');
    } catch (error) {
        console.error('Error al descargar:', error);
        alert('Error al descargar el QR: ' + error.message);
    }
}

// Generar PDF - CORREGIDO
function generatePDF() {
    console.log('Generando PDF...');
    console.log('Datos actuales:', currentData);
    
    if (!currentData || !currentData.placa) {
        alert('Error: No hay datos válidos para generar el PDF.');
        return;
    }
    
    if (!window.jspdf || !window.jspdf.jsPDF) {
        alert('Error: La librería jsPDF no está disponible.');
        return;
    }
    
    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Configurar fuente
        doc.setFont("helvetica");
        
        // Encabezado
        doc.setFontSize(18);
        doc.setTextColor(0, 77, 153);
        doc.text('AUTORIZACIÓN', 105, 25, { align: 'center' });
        
        // Línea separadora
        doc.line(20, 35, 190, 35);
        
        doc.setTextColor(0, 0, 0);
        
        // Mensaje principal
        doc.setFontSize(12);
        const mensaje = `Estimado/a ${currentData.nombres}, este mensaje es para indicarle que se ha emitido la autorización correspondiente desde la Autoridad de Control de Tránsito Milagro (ACT).`;
        
        const margin = 20;
        const maxWidth = 170;
        const lines = doc.splitTextToSize(mensaje, maxWidth);
        
        let y = 50;
        lines.forEach((line, index) => {
            doc.text(line, margin, y + (index * 7));
        });
        
        // Detalles de la autorización
        let detailsY = y + (lines.length * 7) + 15;
        doc.setFontSize(11);
        doc.setFont("helvetica", "bold");
        doc.text('DETALLES DE LA AUTORIZACIÓN:', 20, detailsY);
        
        detailsY += 10;
        doc.setFont("helvetica", "normal");
        doc.text(`• Número de Documento: ${currentData.numero_autorizacion}`, 25, detailsY);
        detailsY += 8;
        doc.text(`• Placa: ${currentData.placa}`, 25, detailsY);
        detailsY += 8;
        doc.text(`• Nombres: ${currentData.nombres}`, 25, detailsY);
        detailsY += 8;
        doc.text(`• Tipo de Autorización: ${currentData.tipo_autorizacion}`, 25, detailsY);
        detailsY += 8;
        doc.text(`• Vigencia: ${currentData.vigencia}`, 25, detailsY);
        
        // Pie de página
        doc.line(20, 260, 190, 260);
        doc.setFontSize(8);
        doc.text('EMOVIM-EP Ecuador', 105, 270, { align: 'center' });
        doc.text('genercia@emovim-ep.gob.ec', 105, 275, { align: 'center' });
        
        // Fecha actual
        const now = new Date();
        doc.text(`Fecha de emisión: ${now.toLocaleDateString('es-EC')} ${now.toLocaleTimeString('es-EC')}`, 105, 285, { align: 'center' });
        
        // Descargar PDF
        doc.save(`Autorizacion_${currentData.placa}_${currentData.nombres.replace(/\s+/g, '_')}.pdf`);
        console.log('PDF generado exitosamente');
    } catch (error) {
        console.error('Error al generar PDF:', error);
        alert('Error al generar PDF: ' + error.message);
    }
}

// Event listeners
document.getElementById('id_tipo_identificacion').addEventListener('change', mostrarInputID);
document.getElementById('id_tipo_autorizacion').addEventListener('change', mostrarInputAutorizacion);
</script>

<style>
/* Estilos específicos para el formulario QR */
.container {
    max-width: 700px;
    margin: 0 auto;
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    border-top: 6px solid #004d99;
}

.header {
    text-align: center;
    margin-bottom: 30px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e9ecef;
}

.header img {
    max-width: 120px;
    margin-bottom: 10px;
}

h1 {
    font-size: 1.8em;
    color: #004d99;
    margin: 0;
    font-weight: 700;
}

.card {
    background-color: #ffffff;
    padding: 25px;
    margin-bottom: 25px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    border: 1px solid #dee2e6;
}

.form-group {
    margin-bottom: 20px;
}

label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: #495057;
}

.form-control {
    width: 100%;
    padding: 12px;
    border: 1px solid #ced4da;
    border-radius: 6px;
    box-sizing: border-box;
    background-color: #f8f9fa;
    color: #495057;
    font-size: 1em;
    transition: border-color 0.2s, box-shadow 0.2s;
}

.form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    outline: none;
    background-color: white;
}

/* Validación visual */
.form-control.valid {
    border-color: #28a745;
    background-color: #f0fff4;
}

.form-control.invalid {
    border-color: #dc3545;
    background-color: #fff5f5;
}

.form-hint {
    display: block;
    margin-top: 5px;
    font-size: 0.85em;
    color: #6c757d;
    font-style: italic;
}

.form-row-double {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.form-group-inline {
    display: flex;
    flex-direction: column;
}

.submit-btn {
    width: 100%;
    padding: 12px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1em;
    font-weight: 600;
    margin-top: 15px;
    transition: background-color 0.2s, transform 0.1s;
}

.submit-btn:hover {
    background-color: #0056b3;
    transform: translateY(-1px);
}

/* Estilos para centrar el QR */
#qr-container {
    text-align: center;
    padding: 30px;
}

#qr-container h3 {
    color: #004d99;
    margin-bottom: 20px;
    font-size: 1.4em;
    font-weight: 600;
}

#qrcode {
    margin: 20px auto;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 10px;
    border: 2px solid #dee2e6;
    width: fit-content;
    margin-left: auto;
    margin-right: auto;
}

/* Centrar el canvas del QR */
#qrcode canvas,
#qrcode img {
    display: block;
    margin: 0 auto;
}

.action-buttons {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 25px;
}

.action-buttons button {
    flex: 0 1 auto;
    min-width: 220px;
    padding: 14px 25px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1em;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.download-btn {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
}

.download-btn:hover {
    background: linear-gradient(135deg, #218838, #1aa179);
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3);
}

.pdf-btn {
    background: linear-gradient(135deg, #dc3545, #c82333);
    color: white;
}

.pdf-btn:hover {
    background: linear-gradient(135deg, #c82333, #bd2130);
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(220, 53, 69, 0.3);
}

#auth-details {
    background: #f8f9fa;
}

#auth-details h3 {
    color: #004d99;
    margin-bottom: 20px;
    font-size: 1.3em;
    font-weight: 600;
}

#auth-details p {
    margin: 12px 0;
    font-size: 1em;
    color: #495057;
}

#auth-details strong {
    color: #212529;
    font-weight: 600;
}

.expiration-message {
    background-color: #fff3cd;
    border: 2px solid #ffc107;
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
    text-align: center;
}

.expiration-message h4 {
    color: #856404;
    margin: 0 0 10px 0;
    font-size: 1.2em;
}

.expiration-message p {
    color: #856404;
    margin: 0;
}

.error-message {
    background-color: #f8d7da;
    border: 1px solid #f5c6cb;
    border-radius: 6px;
    padding: 15px;
    margin-bottom: 20px;
    color: #721c24;
}

.error-message strong {
    display: block;
    margin-bottom: 8px;
}

.error-message ul {
    margin: 10px 0 0 0;
    padding-left: 20px;
}

.error-message li {
    margin: 5px 0;
}

#result-message {
    margin-top: 15px;
    padding: 12px;
    border-radius: 6px;
    text-align: center;
    font-weight: 600;
}

#result-message.success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

#result-message.error {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

/* Responsive para los botones */
@media (max-width: 640px) {
    .action-buttons {
        flex-direction: column;
    }
    
    .action-buttons button {
        width: 100%;
        min-width: auto;
    }
    
    #qrcode {
        padding: 15px;
    }
    
    .form-row-double {
        grid-template-columns: 1fr;
    }
    
    .container {
        padding: 20px;
    }
}

/* Animaciones */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

#qr-container,
#auth-details {
    animation: fadeIn 0.5s ease-out;
}
</style>
{% endblock %}